{\rtf1\ansi\ansicpg1252\cocoartf2761
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\froman\fcharset0 Times-Bold;\f1\froman\fcharset0 Times-Roman;\f2\fswiss\fcharset0 Helvetica;
\f3\froman\fcharset0 Times-Italic;\f4\fmodern\fcharset0 Courier;\f5\fswiss\fcharset0 Arial-BoldMT;
\f6\fswiss\fcharset0 ArialMT;}
{\colortbl;\red255\green255\blue255;\red24\green25\blue27;\red255\green255\blue255;\red254\green246\blue217;
\red24\green24\blue24;\red227\green236\blue254;\red0\green0\blue0;\red251\green226\blue224;}
{\*\expandedcolortbl;;\cssrgb\c12549\c12941\c14118;\cssrgb\c100000\c100000\c100000;\cssrgb\c99608\c96863\c87843;
\cssrgb\c12157\c12157\c12157;\cssrgb\c90980\c94118\c99608;\cssrgb\c0\c0\c0\c5098;\cssrgb\c98824\c90980\c90196;}
{\*\listtable{\list\listtemplateid1\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid1}
{\list\listtemplateid2\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid101\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid2}
{\list\listtemplateid3\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}}{\leveltext\leveltemplateid201\'01\'00;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listname ;}\listid3}
{\list\listtemplateid4\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat2\levelspace360\levelindent0{\*\levelmarker \{decimal\}}{\leveltext\leveltemplateid301\'01\'00;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listname ;}\listid4}
{\list\listtemplateid5\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat4\levelspace360\levelindent0{\*\levelmarker \{decimal\}}{\leveltext\leveltemplateid401\'01\'00;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listname ;}\listid5}
{\list\listtemplateid6\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}}{\leveltext\leveltemplateid501\'01\'00;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listname ;}\listid6}
{\list\listtemplateid7\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat2\levelspace360\levelindent0{\*\levelmarker \{decimal\}}{\leveltext\leveltemplateid601\'01\'00;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listname ;}\listid7}
{\list\listtemplateid8\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid701\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid8}
{\list\listtemplateid9\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}}{\leveltext\leveltemplateid801\'01\'00;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listname ;}\listid9}}
{\*\listoverridetable{\listoverride\listid1\listoverridecount0\ls1}{\listoverride\listid2\listoverridecount0\ls2}{\listoverride\listid3\listoverridecount0\ls3}{\listoverride\listid4\listoverridecount0\ls4}{\listoverride\listid5\listoverridecount0\ls5}{\listoverride\listid6\listoverridecount0\ls6}{\listoverride\listid7\listoverridecount0\ls7}{\listoverride\listid8\listoverridecount0\ls8}{\listoverride\listid9\listoverridecount0\ls9}}
\paperw11900\paperh16840\margl1440\margr1440\vieww33100\viewh16740\viewkind0
\deftab720
\pard\pardeftab720\sa640\partightenfactor0

\f0\b\fs60 \cf2 \cb3 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Introduction\
\pard\pardeftab720\sa480\partightenfactor0

\f1\b0\fs32 \cf2 In a challenge lab you\'92re given a scenario and a set of tasks. Instead of following step-by-step instructions, you will use the skills learned from the labs in the course to figure out how to complete the tasks on your own! An automated scoring system (shown on this page) will provide feedback on whether you have completed your tasks correctly.\
When you take a challenge lab, you will not be taught new Google Cloud concepts. You are expected to extend your learned skills, like changing default values and reading and researching error messages to fix your own mistakes.\
To score 100% you must successfully complete all tasks within the time period!\
This lab is recommended for students who have enrolled in the\'a0{\field{\*\fldinst{HYPERLINK "https://www.cloudskillsboost.google/course_templates/637"}}{\fldrslt \cf2 \cb3 \strokec2 Set Up an App Dev Environment on Google Cloud}}\'a0skill badge. Are you ready for the challenge?\
\pard\pardeftab720\sa640\partightenfactor0

\f0\b\fs60 \cf2 Challenge scenario\
\pard\pardeftab720\sa480\partightenfactor0

\f1\b0\fs32 \cf2 You are just starting your junior cloud engineer role with Jooli inc. So far you have been helping teams create and manage Google Cloud resources.\
You are expected to have the skills and knowledge for these tasks, so don\'92t expect step-by-step guides.\
\pard\pardeftab720\sa640\partightenfactor0

\f2\fs48 \cf2 \cb3 \strokec2 Your challenge\
\pard\pardeftab720\sa480\partightenfactor0

\f1\fs32 \cf2 \cb3 \strokec2 You are asked to help a newly formed development team with some of their initial work on a new project around storing and organizing photographs, called\'a0
\f3\i \cf2 \cb3 \strokec2 Memories
\f1\i0 \cf2 \cb3 \strokec2 . You have been asked to assist the Memories team with initial configuration for their application development environment.\
You receive the following request to complete the following tasks:\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls1\ilvl0\cf2 \cb3 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Create a bucket for storing the photographs.\cb1 \
\ls1\ilvl0\cb3 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Create a Pub/Sub topic that will be used by a Cloud Function you create.\cb1 \
\ls1\ilvl0\cb3 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Create a Cloud Function.\cb1 \
\ls1\ilvl0\cb3 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Remove the previous cloud engineer\'92s access from the memories project.\cb1 \
\pard\pardeftab720\sa480\partightenfactor0
\cf2 \cb3 \strokec2 Some Jooli Inc. standards you should follow:\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls2\ilvl0\cf2 \cb3 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Create all resources in the\'a0
\f4 \cb4 REGION
\f1 \cb3 \'a0region and\'a0
\f4 \cb4 ZONE
\f1 \cb3 \'a0zone, unless otherwise directed.\cb1 \
\ls2\ilvl0\cb3 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Use the project VPCs.\cb1 \
\ls2\ilvl0\cb3 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Naming is normally\'a0
\f3\i team-resource
\f1\i0 , e.g. an instance could be named\'a0
\f0\b kraken-webserver1
\f1\b0 \cb1 \
\ls2\ilvl0\cb3 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Allocate cost effective resource sizes. Projects are monitored and excessive resource use will result in the containing project's termination (and possibly yours), so beware. This is the guidance the monitoring team is willing to share; unless directed, use\'a0
\f0\b e2-micro
\f1\b0 \'a0for small Linux VMs and\'a0
\f0\b e2-medium
\f1\b0 \'a0for Windows or other applications such as Kubernetes nodes.\cb1 \
\pard\pardeftab720\sa480\partightenfactor0
\cf2 \cb3 \strokec2 Each task is described in detail below, good luck!\
\pard\pardeftab720\sa640\partightenfactor0

\f0\b\fs60 \cf2 Task 1. Create a bucket\
\pard\pardeftab720\sa480\partightenfactor0

\f1\b0\fs32 \cf2 You need to create a bucket called\'a0
\f4 \cf2 \cb4 \strokec2 Bucket Name
\f1 \cf2 \cb3 \strokec2 \'a0for the storage of the photographs. Ensure the resource is created in the\'a0
\f4 \cf2 \cb4 \strokec2 REGION
\f1 \cf2 \cb3 \strokec2 \'a0region and\'a0
\f4 \cf2 \cb4 \strokec2 ZONE
\f1 \cf2 \cb3 \strokec2 \'a0zone.\
\pard\pardeftab720\sa640\partightenfactor0

\f0\b\fs60 \cf2 Task 2. Create a Pub/Sub topic\
\pard\pardeftab720\sa480\partightenfactor0

\f1\b0\fs32 \cf2 Create a Pub/Sub topic called\'a0
\f4 \cf2 \cb4 \strokec2 Topic Name
\f1 \cf2 \cb3 \strokec2 \'a0for the Cloud Function to send messages.\
\pard\pardeftab720\sa640\partightenfactor0

\f0\b\fs60 \cf2 Task 3. Create the thumbnail Cloud Function\
\pard\pardeftab720\sa480\partightenfactor0

\f1\b0\fs32 \cf2 Create a Cloud Function\'a0
\f4 \cf2 \cb4 \strokec2 Cloud Function Name
\f1 \cf2 \cb3 \strokec2 \'a0that will to create a thumbnail from an image added to the\'a0
\f4 \cf2 \cb4 \strokec2 Bucket Name
\f1 \cf2 \cb3 \strokec2 \'a0bucket. Ensure the Cloud Function is using the 2nd Generation environment. Ensure the resource is created in the\'a0
\f4 \cf2 \cb4 \strokec2 REGION
\f1 \cf2 \cb3 \strokec2 \'a0region and\'a0
\f4 \cf2 \cb4 \strokec2 ZONE
\f1 \cf2 \cb3 \strokec2 \'a0zone.\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls3\ilvl0\cf2 \cb3 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	1	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Create a Cloud Function called\'a0
\f4 \cb4 Cloud Function Name
\f1 \cb1 \
\pard\pardeftab720\partightenfactor0

\f5\b\fs24 \AppleTypeServices\AppleTypeServicesF65539 \cf5 \cb6 \strokec5 Note:
\f6\b0 \AppleTypeServices\AppleTypeServicesF65539 \'a0
\f1 \AppleTypeServices The Cloud Function is required to executes every time an object is created in the bucket created in Task 1. During the process Cloud Function may request permission to enable APIs. Please enable each of the required APIs as requested.
\f6 \AppleTypeServices\AppleTypeServicesF65539 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa480\partightenfactor0
\ls4\ilvl0
\f1\fs32 \AppleTypeServices \cf2 \cb3 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	2	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Make sure you set the\'a0
\f0\b Entry point
\f1\b0 \'a0(Function to execute) to\'a0
\f4 \cb4 Cloud Function Name
\f1 \cb3 \'a0and\'a0
\f0\b Trigger
\f1\b0 \'a0to\'a0
\f4\fs30 \cb7 Cloud Storage
\f1\fs32 \cb3 .\cb1 \
\ls4\ilvl0\cb3 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	3	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Add the following code to the\'a0
\f4\fs30 \cb7 index.js
\f1\fs32 \cb3 :\cb1 \
\pard\pardeftab720\sa480\partightenfactor0
\cf2 \cb3 \strokec2 const functions = require('@google-cloud/functions-framework');\
const crc32 = require("fast-crc32c");\
const \{ Storage \} = require('@google-cloud/storage');\
const gcs = new Storage();\
const \{ PubSub \} = require('@google-cloud/pubsub');\
const imagemagick = require("imagemagick-stream");\
\
functions.cloudEvent('', cloudEvent => \{\
  const event = cloudEvent.data;\
\
  console.log(`Event: $\{event\}`);\
  console.log(`Hello $\{event.bucket\}`);\
\
  const fileName = event.name;\
  const bucketName = event.bucket;\
  const size = "64x64"\
  const bucket = gcs.bucket(bucketName);\
  const topicName = "";\
  const pubsub = new PubSub();\
  if ( fileName.search("64x64_thumbnail") == -1 )\{\
    // doesn't have a thumbnail, get the filename extension\
    var filename_split = fileName.split('.');\
    var filename_ext = filename_split[filename_split.length - 1];\
    var filename_without_ext = fileName.substring(0, fileName.length - filename_ext.length );\
    if (filename_ext.toLowerCase() == 'png' || filename_ext.toLowerCase() == 'jpg')\{\
      // only support png and jpg at this point\
      console.log(`Processing Original: gs://$\{bucketName\}/$\{fileName\}`);\
      const gcsObject = bucket.file(fileName);\
      let newFilename = filename_without_ext + size + '_thumbnail.' + filename_ext;\
      let gcsNewObject = bucket.file(newFilename);\
      let srcStream = gcsObject.createReadStream();\
      let dstStream = gcsNewObject.createWriteStream();\
      let resize = imagemagick().resize(size).quality(90);\
      srcStream.pipe(resize).pipe(dstStream);\
      return new Promise((resolve, reject) => \{\
        dstStream\
          .on("error", (err) => \{\
            console.log(`Error: $\{err\}`);\
            reject(err);\
          \})\
          .on("finish", () => \{\
            console.log(`Success: $\{fileName\} \uc0\u8594  $\{newFilename\}`);\
              // set the content-type\
              gcsNewObject.setMetadata(\
              \{\
                contentType: 'image/'+ filename_ext.toLowerCase()\
              \}, function(err, apiResponse) \{\});\
              pubsub\
                .topic(topicName)\
                .publisher()\
                .publish(Buffer.from(newFilename))\
                .then(messageId => \{\
                  console.log(`Message $\{messageId\} published.`);\
                \})\
                .catch(err => \{\
                  console.error('ERROR:', err);\
                \});\
          \});\
      \});\
    \}\
    else \{\
      console.log(`gs://$\{bucketName\}/$\{fileName\} is not an image I can handle`);\
    \}\
  \}\
  else \{\
    console.log(`gs://$\{bucketName\}/$\{fileName\} already has a thumbnail`);\
  \}\
\});\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls5\ilvl0\cf2 \cb3 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	4	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Add the following code to the\'a0
\f4\fs30 \cb7 package.json
\f1\fs32 \cb3 :\
\pard\tx720\pardeftab720\partightenfactor0
\cf2 \cb1 \strokec2 \
\{\
  "name": "thumbnails",\
  "version": "1.0.0",\
  "description": "Create Thumbnail of uploaded image",\
  "scripts": \{\
    "start": "node index.js"\
  \},\
  "dependencies": \{\
    "@google-cloud/functions-framework": "^3.0.0",\
    "@google-cloud/pubsub": "^2.0.0",\
    "@google-cloud/storage": "^5.0.0",\
    "fast-crc32c": "1.0.4",\
    "imagemagick-stream": "4.1.1"\
  \},\
  "devDependencies": \{\},\
  "engines": \{\
    "node": ">=4.3.2"\
  \}\
\}\
\
\
\pard\pardeftab720\sa480\partightenfactor0
\cf2 \cb3 \strokec2 Verify the thumbnail was successfully created.\
\pard\pardeftab720\partightenfactor0

\f5\b\fs24 \AppleTypeServices\AppleTypeServicesF65539 \cf5 \cb8 \strokec5 Note:
\f6\b0 \AppleTypeServices\AppleTypeServicesF65539 \'a0
\f1 \AppleTypeServices If you get a permission denied error stating it may take a few minutes before all necessary permissions are propagated to the Service Agent, wait a few minutes and try again. Ensure you have the relevant roles (Eventarc Service Agent, Eventarc Event Receiver, Service Account Token Creator, and Pub/Sub Publisher) assigned to the correct service accounts.
\f6 \AppleTypeServices\AppleTypeServicesF65539 \
\pard\tx720\pardeftab720\partightenfactor0

\f1\fs32 \AppleTypeServices \cf2 \cb1 \strokec2 \
\pard\pardeftab720\sa640\partightenfactor0

\f0\b\fs60 \cf2 \cb3 \strokec2 Task 4. Test the Infrastructure\
\pard\pardeftab720\sa480\partightenfactor0

\f1\b0\fs32 \cf2 You must upload one JPG or PNG image into the bucket\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls6\ilvl0\cf2 \cb3 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	1	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Upload a PNG or JPG image to\'a0
\f4 \cb4 Bucket Name
\f1 \cb3 \'a0bucket.\cb1 \
\pard\pardeftab720\partightenfactor0

\f5\b\fs24 \AppleTypeServices\AppleTypeServicesF65539 \cf5 \cb6 \strokec5 Note:
\f6\b0 \AppleTypeServices\AppleTypeServicesF65539 \'a0
\f1 \AppleTypeServices Alternatively Download this image
\f6 \AppleTypeServices\AppleTypeServicesF65539 \'a0
\f4\fs30 \AppleTypeServices \cf5 \cb7 \strokec5 https://storage.googleapis.com/cloud-training/gsp315/map.jpg
\f6\fs24 \AppleTypeServices\AppleTypeServicesF65539 \cf5 \cb6 \strokec5 \'a0
\f1 \AppleTypeServices to your machine. Then upload it to the bucket.
\f6 \AppleTypeServices\AppleTypeServicesF65539 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls7\ilvl0
\f1\fs32 \AppleTypeServices \cf2 \cb3 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	2	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 You will see a thumbnail image appear shortly afterwards (use\'a0
\f0\b REFRESH
\f1\b0 \'a0in the bucket details).\cb1 \
\pard\tx720\pardeftab720\partightenfactor0
\cf2 \strokec2 \
\
\pard\pardeftab720\sa640\partightenfactor0

\f0\b\fs60 \cf2 \cb3 \strokec2 Task 5. Remove the previous cloud engineer\
\pard\pardeftab720\sa480\partightenfactor0

\f1\b0\fs32 \cf2 You will see that there are two users defined in the project.\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls8\ilvl0\cf2 \cb3 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 One is your account (
\f4 \cb4 Username 1
\f1 \cb3 \'a0with the role of Owner).\cb1 \
\ls8\ilvl0\cb3 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 The other is the previous cloud engineer (
\f4 \cb4 Username 2
\f1 \cb3 \'a0with the role of Viewer).\cb1 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls9\ilvl0\cf2 \cb3 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	1	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Remove the previous cloud engineer\'92s access from the project.\cb1 \
\pard\tx720\pardeftab720\partightenfactor0
\cf2 \strokec2 \
\
\pard\pardeftab720\sa640\partightenfactor0

\f2\fs48 \cf2 \cb3 \strokec2 Next steps / Learn more\
\pard\pardeftab720\sa480\partightenfactor0

\f1\fs32 \cf2 \cb3 \strokec2 This skill badge is part of Google's\'a0{\field{\*\fldinst{HYPERLINK "https://google.qwiklabs.com/quests/118"}}{\fldrslt \cf2 \cb3 \strokec2 Perform Foundational Infrastructure Tasks in Google Cloud}}\'a0and\'a0{\field{\*\fldinst{HYPERLINK "https://cloud.google.com/training/cloud-infrastructure#cloud-architect-learning-path"}}{\fldrslt \cf2 \cb3 \strokec2 Cloud Architect}}\'a0learning paths. If you have already completed the other skill badges in your learning path, search the\'a0{\field{\*\fldinst{HYPERLINK "https://google.qwiklabs.com/catalog"}}{\fldrslt \cf2 \cb3 \strokec2 Google Cloud Skills Boost catalog}}\'a0for other skill badges in which you can enroll.\
\pard\tx720\pardeftab720\partightenfactor0
\cf2 \cb1 \strokec2 \
}